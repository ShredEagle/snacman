set(TARGET_NAME snacman)


set(AUTOGEN_DISCLAIMER "/* WARNING: Autogenerated file, do not edit. All changes will be lost. */")
set(REPO_FOLDER ${PROJECT_SOURCE_DIR})
configure_file(build_info.h.in build_info.h @ONLY)

set(${TARGET_NAME}_HEADERS
    DebugDrawing.h
    DevmodeControl.h
    EntityUtilities.h
    GraphicState.h
    ImguiUtilities.h
    Input.h
    Logging.h
    LoopSettings.h
    Profiling.h
    ProfilingGPU.h
    QueryManipulation.h
    RenderThread.h
    Resources.h
    SparseSet.h
    Timing.h

    simulations/sandbox/ModelLoader.h

    simulations/snacgame/EntityWrap.h
    simulations/snacgame/Entities.h
    simulations/snacgame/GameContext.h
    simulations/snacgame/GameParameters.h
    simulations/snacgame/GraphicState.h
    simulations/snacgame/ImguiInhibiter.h
    simulations/snacgame/ImguiSceneEditor.h
    simulations/snacgame/InputConstants.h
    simulations/snacgame/InputCommandConverter.h
    simulations/snacgame/LevelHelper.h
    simulations/snacgame/ModelInfos.h
    simulations/snacgame/OrbitalControlInput.h
    simulations/snacgame/PlayerSlotManager.h
    simulations/snacgame/Renderer.h
    simulations/snacgame/Renderer_V1.h
    simulations/snacgame/Renderer_V2.h
    simulations/snacgame/SceneGraph.h
    simulations/snacgame/SnacGame.h
    simulations/snacgame/SimulationControl.h
    simulations/snacgame/typedef.h

    simulations/snacgame/component/Collision.h
    simulations/snacgame/component/Context.h
    simulations/snacgame/component/Controller.h
    simulations/snacgame/component/Explosion.h
    simulations/snacgame/component/Geometry.h
    simulations/snacgame/component/GlobalPose.h
    simulations/snacgame/component/LevelData.h
    simulations/snacgame/component/MenuItem.h
    simulations/snacgame/component/MovementScreenSpace.h
    simulations/snacgame/component/PathToOnGrid.h
    simulations/snacgame/component/PlayerHud.h
    simulations/snacgame/component/PlayerJoinData.h
    simulations/snacgame/component/PlayerSlot.h
    simulations/snacgame/component/PlayerGameData.h
    simulations/snacgame/component/PlayerRoundData.h
    simulations/snacgame/component/Portal.h
    simulations/snacgame/component/PoseScreenSpace.h
    simulations/snacgame/component/PowerUp.h
    simulations/snacgame/component/RigAnimation.h
    simulations/snacgame/component/SceneNode.h
    simulations/snacgame/component/Spawner.h
    simulations/snacgame/component/Tags.h
    simulations/snacgame/component/Text.h
    simulations/snacgame/component/VisualModel.h

    simulations/snacgame/scene/GameScene.h
    simulations/snacgame/scene/DataScene.h
    simulations/snacgame/scene/JoinGameScene.h
    simulations/snacgame/scene/MenuScene.h
    simulations/snacgame/scene/PauseScene.h
    simulations/snacgame/scene/DisconnectedControllerScene.h
    simulations/snacgame/scene/Scene.h
    simulations/snacgame/scene/SettingsScene.h

    simulations/snacgame/system/AdvanceAnimations.h
    simulations/snacgame/system/AllowMovement.h
    simulations/snacgame/system/AnimationManager.h
    simulations/snacgame/system/ConsolidateGridMovement.h
    simulations/snacgame/system/Debug_BoundingBoxes.h
    simulations/snacgame/system/EatPill.h
    simulations/snacgame/system/Explosion.h
    simulations/snacgame/system/InputProcessor.h
    simulations/snacgame/system/IntegratePlayerMovement.h
    simulations/snacgame/system/MenuManager.h
    simulations/snacgame/system/MovementIntegration.h
    simulations/snacgame/system/LevelManager.h
    simulations/snacgame/system/Pathfinding.h
    simulations/snacgame/system/PlayerSpawner.h
    simulations/snacgame/system/PlayerInvulFrame.h
    simulations/snacgame/system/PortalManagement.h
    simulations/snacgame/system/PowerUpUsage.h
    simulations/snacgame/system/RoundMonitor.h
    simulations/snacgame/system/SystemOrbitalCamera.h
    simulations/snacgame/system/SceneGraphResolver.h
    simulations/snacgame/system/SceneStack.h

    detail/Logger.h
)

set(${TARGET_NAME}_SOURCES
    main.cpp

    DebugDrawing.cpp
    Input.cpp
    RenderThread.cpp
    Resources.cpp

    simulations/sandbox/ModelLoader.cpp

    simulations/snacgame/Entities.cpp
    simulations/snacgame/GameContext.cpp
    simulations/snacgame/ImguiSceneEditor.cpp
    simulations/snacgame/OrbitalControlInput.cpp
    simulations/snacgame/PlayerSlotManager.cpp
    simulations/snacgame/Renderer_V1.cpp
    simulations/snacgame/Renderer_V2.cpp
    simulations/snacgame/SnacGame.cpp
    simulations/snacgame/SimulationControl.cpp
    simulations/snacgame/SceneGraph.cpp

    simulations/snacgame/component/Context.cpp
    simulations/snacgame/component/DebugUi.cpp
    simulations/snacgame/component/PlayerHud.cpp

    simulations/snacgame/scene/Scene.cpp
    simulations/snacgame/scene/GameScene.cpp
    simulations/snacgame/scene/DisconnectedControllerScene.cpp
    simulations/snacgame/scene/JoinGameScene.cpp
    simulations/snacgame/scene/MenuScene.cpp
    simulations/snacgame/scene/PauseScene.cpp
    simulations/snacgame/scene/SettingsScene.cpp

    simulations/snacgame/system/AdvanceAnimations.cpp
    simulations/snacgame/system/AllowMovement.cpp
    simulations/snacgame/system/AnimationManager.cpp
    simulations/snacgame/system/ConsolidateGridMovement.cpp
    simulations/snacgame/system/Debug_BoundingBoxes.cpp
    simulations/snacgame/system/EatPill.cpp
    simulations/snacgame/system/Explosion.cpp
    simulations/snacgame/system/InputProcessor.cpp
    simulations/snacgame/system/IntegratePlayerMovement.cpp
    simulations/snacgame/system/MenuManager.cpp
    simulations/snacgame/system/MovementIntegration.cpp
    simulations/snacgame/system/LevelManager.cpp
    simulations/snacgame/system/SystemOrbitalCamera.cpp
    simulations/snacgame/system/Pathfinding.cpp
    simulations/snacgame/system/PlayerSpawner.cpp
    simulations/snacgame/system/PlayerInvulFrame.cpp
    simulations/snacgame/system/PortalManagement.cpp
    simulations/snacgame/system/PowerUpUsage.cpp
    simulations/snacgame/system/RoundMonitor.cpp
    simulations/snacgame/system/SceneGraphResolver.cpp
    simulations/snacgame/system/SceneStack.cpp

    detail/Logger.cpp
)

source_group(TREE ${CMAKE_CURRENT_LIST_DIR}
             FILES ${${TARGET_NAME}_HEADERS} ${${TARGET_NAME}_SOURCES}
)

source_group(generated FILES ${CMAKE_CURRENT_BINARY_DIR}/build_info.h)

add_executable(${TARGET_NAME}
               ${${TARGET_NAME}_SOURCES}
               ${${TARGET_NAME}_HEADERS}
               # Not listed in headers, as it cannot be grouped by "source_group"
               ${CMAKE_CURRENT_BINARY_DIR}/build_info.h
)

if(MSVC)
    # Otherwise GameScene-setup.cpp errors:
    # "fatal  error C1128: number of sections exceeded object file format limit: compile with /bigobj"
    target_compile_options(${TARGET_NAME} PRIVATE "/bigobj")
endif()

cmc_target_current_include_directory(${TARGET_NAME} ADD_BINARY_DIR PRIVATE)

set_target_properties(${TARGET_NAME} PROPERTIES
                      VERSION "${${PROJECT_NAME}_VERSION}"
)

option(BUILD_SNACMAN_DEVMODE "Build with all devmode features enabled." OFF)
if(BUILD_SNACMAN_DEVMODE)
    target_compile_definitions(${TARGET_NAME} PRIVATE "SNACMAN_DEVMODE")
else()
    target_compile_definitions(${TARGET_NAME} PRIVATE "DBGDRAW_ACTIVE_LEVEL=::ad::snac::DebugDrawer::Level::off")
endif()

cmc_cpp_all_warnings_as_errors(${TARGET_NAME} ENABLED ${BUILD_CONF_WarningAsError})

cmc_cpp_sanitizer(${TARGET_NAME} ${BUILD_CONF_Sanitizer})

file(GENERATE 
     OUTPUT $<TARGET_FILE_DIR:${TARGET_NAME}>/assets.json
     CONTENT "{\"prefixes\": [\"${REPO_FOLDER}/src/libs/snac-renderer-V1/snac-renderer-V1/\",
                              \"${REPO_FOLDER}/../snac-assets/\"]}")


##
## Dependencies
##

find_package(Entity CONFIG REQUIRED entity)
find_package(Graphics CONFIG REQUIRED arte graphics imguiui)
find_package(Math CONFIG REQUIRED math)
find_package(Handy CONFIG REQUIRED platform)
find_package(MarkovJunior CONFIG REQUIRED markovjunior)

find_package(nlohmann_json 3.11.2 CONFIG REQUIRED)
find_package(spdlog CONFIG REQUIRED)

target_link_libraries(${TARGET_NAME}
    PRIVATE
        ad::profiler
        ad::snac-renderer-V1 # TODO #RV2 remove
        ad::snac-renderer-V2

        ad::arte
        ad::entity
        ad::graphics
        ad::imguiui
        ad::math
        ad::platform
        ad::markovjunior

        spdlog::spdlog
        nlohmann_json::nlohmann_json
)


##
## Install
##

install(TARGETS ${TARGET_NAME})
